<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/layout-registrant}">

<!-- index.html 고유 CSS 추가 -->
<th:block layout:fragment="css">
</th:block>

<!-- index.html 고유 스크립트 추가 -->
<th:block layout:fragment="script">

</th:block>

<div class="rightCnt" layout:fragment="content">
    <!-- title area -->
    <div class="titWrap">
        <h2 class="h2">상품 수정</h2>
        <div class="breadWrap">
            <ol class="breadcrumb">
                <li><a href="#">Home</a></li>
                <li><a href="#">등록 상품</a></li>
                <li class="active">상품 수정</li><!-- 마지막 li -->
            </ol>
        </div>
    </div>
    <!-- //title area -->

    <!-- content -->
    <div class="content">
        <form th:action="@{/softwares}" th:object="${software}" action="#" id="updateSoftwareForm" method="post" enctype="multipart/form-data" onsubmit="return chk();">
        <!-- cBox1 -->
        <div class="cBox type1 appCnt-info">
            <div class="cBox-hd">
                <h4 class="c-tit">상품 수정하기</h4>
            </div>
            <div class="cBox-cnt pt20">
                <!-- inner -->
                <div class="in d_block">
                    <!-- table top -->
                    <div class="tb-top">
                        <div class="pull-right">
                            <span class="point2"><i class="i_star">필수입력</i> 는 필수입력 사항입니다.</span>
                        </div>
                    </div>
                    <!-- //table top -->
                    <!-- table -->
                    <div class="tbw type1">
                        <table class="table">
                            <colgroup>
                                <col style="width:15%;">
                                <col style="width:auto;">
                            </colgroup>
                            <tbody>
                            <tr>
                                <th scope="row">상품명<i class="i_star">필수입력</i></th>
                                <td><input class="form-control" type="text" th:value="${software.name}" id="softwareName" maxlength="250"></td>
                            </tr>
                            <tr>
                                <th scope="row">카테고리<i class="i_star">필수입력</i></th>
                                <td>
                                    <select id="softwareCategory">
                                        <option th:each="category : ${categories}"
                                                th:value="${category.id}"
                                                th:utext="${category.name}"
                                                th:selected="${category.id} == ${software.category.id}">
                                        </option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">개요<i class="i_star">필수입력</i></th>
                                <td><textarea th:text="${software.summary}" id="softwareSummary" style="height:150px;" maxlength="500"></textarea></td>
                            </tr>
                            <!--/*################################# START ICON CREATE #################################*/-->
                            <tr th:if="${software.iconPath == null}"><!-- CREATE -->
                                <th scope="row">아이콘<i class="i_star">필수입력</i></th>
                                <td id="ICON_REGISTRY_AREA">
                                    <div class="fileUploadWrap selected_ico" style="width:50%;">
                                        <input tabindex="-1" class="form-control" id="iconFileInput" style="position: absolute; clip: rect(0px 0px 0px 0px);" type="file" name="iconFile" data-icon-name="fa fa-upload" data-button-text="" data-class-input="form-control" data-class-button="btn btn-default" filestyle="" onchange="getThumbnailPreview(this, $('#icon_image'))">
                                        <div class="bootstrap-filestyle input-group">
                                                <span tabindex="0" class="group-span-filestyle input-group-btn">
                                                    <label class="btn btn-default " for="iconFileInput" id="icon_image">
                                                        <span class="ico ico_fileupload">파일찾기</span>
                                                    </label>
                                                </span>
                                            <div class="input-form-group">
                                                <input name="userfile" disabled="" class="form-control" id="iconFile" type="text" placeholder="아이콘으로 등록할 이미지를 선택하세요.">
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <!--/*################################# END ICON CREATE #################################*/-->
                            <!--/*################################# START ICON VIEW #################################*/-->
                            <tr th:if="${software.iconPath != null}"><!-- VIEW -->
                                <th scope="row">아이콘<i class="i_star">필수입력</i></th>
                                <td id="ICON_REGISTRY_AREA">
                                    <div class="fileUploadWrap selected_ico" style="width:50%;" name="reSelectPreview">
                                        <input tabindex="-1" class="form-control" id="iconFileInput" name="iconFile" multiple style="position: absolute; clip: rect(0px 0px 0px 0px);" type="file" data-icon-name="fa fa-upload" data-button-text="" data-class-input="form-control" data-class-button="btn btn-default" filestyle="" onchange="getThumbnailPreview(this, $('#icon_image'))">
                                        <div class="bootstrap-filestyle input-group" id="bootstrap-filestyle input-group">
                                            <span tabindex="0" class="group-span-filestyle input-group-btn">
                                                 <label class="btn btn-default " for="iconFileInput" id="icon_image">
                                                    <span class="ico ico_fileupload">파일찾기</span>
                                                </label>
                                            </span>
                                            <div class="input-form-group">
                                                <input name="userfile" disabled="" class="form-control" id="userfile" type="text" placeholder="아이콘으로 등록할 이미지를 선택하세요.">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="fileUploadWrap selected_ico" style="width:50%;" name="divPreview">
                                        <div class="bootstrap-filestyle input-group" id="bootstrap-filestyle input-group2">
                                            <span tabindex="0" class="group-span-filestyle input-group-btn">
                                                 <label class="btn btn-default ">
                                                    <img class="logo" alt="" th:src="${software.iconPath}" id="iconFilePath" />
                                                 </label>
                                            </span>
                                            <div class="input-form-group">&nbsp;
                                                <a href="" data-toggle="modal" data-target="#myModal_icon_del"><img src="../../static/images/ico_delete.png" alt="" /></a>&nbsp;
                                                <span th:text="${software.icon}" id="iconFileNamePreview"></span>
                                            </div>
                                            <div>
                                                <label id="serviceLabelThumbName2" name="labelThumbName"></label>
                                                <div id="serviceThumRemove2" name="thumRemove" class="pull-right file-remove-button">
                                                    <i class="fa fa-times"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <!--/*################################# END ICON VIEW #################################*/-->
                            <!--/*################################# START SCREENSHOT #################################*/-->
                            <tr>
                                <th scope="row">스크린샷<i class="i_star">필수입력</i></th>
                                <td>
                                    <div class="screenShotBox">
                                        <div class="sshotWrap">
                                            <ul id="screenShotTotal">
                                                <li name="li_in" th:id="'li_in' + ${index.index}" th:each="screenshot, index : ${software.screenshotList}">
                                                    <div class="sshot_in" th:id="${index.index}">
                                                        <img th:src="${screenshot}" alt="" th:id="'image_form_url' + ${index.index}"/>
                                                        <a href="#" onclick="clickModal(this)" th:id="${index.index}" /><span class="ico ico_delete" name="ico_delete" th:id="${index.index}">X</span></a>
                                                    </div>
                                                </li>
                                                <li id="li_0">
                                                    <div class="fileUploadWrap selected_sshot">
                                                        <input tabindex="-1" class="form-control" id="screenshotFileInput" style="position: absolute; clip: rect(0px 0px 0px 0px);" type="file" name="screenshots"
                                                               multiple="multiple" data-icon-name="fa fa-upload" data-button-text="" data-class-input="form-control" data-class-button="btn btn-default" filestyle=""
                                                               onchange="getThumbnailPreviewScreenshot(this, $('#screenshot_image_list'), 0)">
                                                        <div class="bootstrap-filestyle input-group">
                                                            <span tabindex="0" class="group-span-filestyle input-group-btn">
                                                                <label class="btn btn-default " for="screenshotFileInput" id="screenshot_image_list">
                                                                    <span class="ico ico_fileupload">파일찾기</span>
                                                                </label>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <!--/*################################# END SCREENSHOT #################################*/-->
                            <tr>
                                <th scope="row">상세설명</th>
                                <td>
                                    <div class="tbw_inner_txt">
                                        <textarea th:text="${software.description}" id="softwareDescription" style="height:150px;" maxlength="3000"></textarea>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">파일유형<i class="i_star">필수입력</i></th>
                                <td>
                                    <div class="radio radio-inline" th:each="type : ${types}" th:if="${#strings.equals(software.status, 'Pending')}">
                                        <input name="softwareType" th:id="'radio1-' + ${type}" type="radio" th:value="${type}" th:checked="${software.type} == ${type}" >
                                        <label class="label" th:for="'radio1-' + ${type}" th:text="${type}"></label>
                                    </div>
                                    <div class="radio radio-inline" th:each="type : ${types}" th:if="${#strings.equals(software.status, 'Approval')}">
                                        <input name="softwareType" th:id="'radio1-' + ${type}" type="radio" th:value="${type}" th:checked="${software.type} == ${type}" disabled>
                                        <label class="label" th:for="'radio1-' + ${type}" th:text="${type}"></label>
                                    </div>
                                </td>
                            </tr>

                            <tr>
                                <th scope="row">상품파일<i class="i_star">필수입력</i></th>
                                <td>
                                    <!-- 첨부파일 -->
                                    <div class="fileUploadWrap" style="width:50%;" th:if="${#strings.equals(software.status, 'Pending')}">
                                        <input tabindex="-1" class="form-control" id="softwareAppFileInput" multiple style="position: absolute; clip: rect(0px 0px 0px 0px);" type="file" name="softwareAppFile" onchange="extractFileName(this, $('#softwareAppFile'), 'prodFile')" data-icon-name="fa fa-upload" data-button-text="" data-class-input="form-control" data-class-button="btn btn-default" filestyle="">
                                        <div class="bootstrap-filestyle input-group" id="softwareAppFileDiv">
                                            <input class="form-control" id="softwareAppFile" type="text" th:value="${software.app}">
                                            <span tabindex="0" class="group-span-filestyle input-group-btn">
                                                <label class="btn btn-default" for="softwareAppFileInput">
                                                    <span class="btn btn-md btn-color1">파일찾기</span>
                                                </label>
                                            </span>
                                            <span tabindex="0" class="group-span-filestyle input-group-btn">
                                                <button type="button" class="btn-sm btn-color2" id="deleteProdFile">삭제</button>
                                            </span>
                                        </div>
                                    </div>
                                    <!-- //첨부파일 -->
                                    <!-- 첨부파일 -->
                                    <div class="fileUploadWrap" style="width:50%;" th:if="${#strings.equals(software.status, 'Approval')}">
                                        <input class="form-control" type="text" name="softwareAppFile" th:value="${software.app}" readonly>
                                    </div>
                                    <!-- //첨부파일 -->
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">환경파일<i class="i_star">필수입력</i></th>
                                <td>
                                    <!-- 첨부파일 -->
                                    <div class="fileUploadWrap" style="width:50%;" th:if="${#strings.equals(software.status, 'Pending')}">
                                        <input tabindex="-1" class="form-control" id="softwareManifestInput" multiple style="position: absolute; clip: rect(0px 0px 0px 0px);" type="file" name="softwareManifest" onchange="extractFileName(this, $('#softwareManifest'), 'envFile')" data-icon-name="fa fa-upload" data-button-text="" data-class-input="form-control" data-class-button="btn btn-default" filestyle="">
                                        <div class="bootstrap-filestyle input-group" id="softwareManifestFileDiv">
                                            <input id="softwareManifest" class="form-control" type="text" th:value="${software.manifest}">
                                            <span tabindex="0" class="group-span-filestyle input-group-btn">
                                                <label class="btn btn-dfefault" for="softwareManifestInput">
                                                    <span class="btn btn-md btn-color1">파일찾기</span>
                                                </label>
                                            </span>
                                            <span tabindex="0" class="group-span-filestyle input-group-btn">
                                                <button type="button" class="btn-sm btn-color2" id="deleteManifestFile">삭제</button>
                                            </span>
                                        </div>
                                    </div>
                                    <!-- //첨부파일 -->
                                    <!-- 첨부파일 -->
                                    <div class="fileUploadWrap" style="width:50%;" th:if="${#strings.equals(software.status, 'Approval')}">
                                        <input class="form-control" type="text" name="softwareManifestFile" th:value="${software.manifest}" readonly>
                                    </div>
                                    <!-- //첨부파일 -->
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">판매금액 적용월</th>
                                <td>
                                    <div class="searchBox"><!--검색폼 두줄일 때 class="fm-row-2"-->
                                        <!-- Form 날짜 -->
                                        <div class="form-group">
                                            <div class="form-group-area">
                                                <div class="fm_box w_auto pr10">
                                                    <select name="selectDateYear" id="selectDateYear" th:onchange="selectYear()"></select>
                                                </div>
                                                <div class="fm_box w_auto">
                                                    <select name="selectDateMonth" id="selectDateMonth" th:onchange="selectMonth()"></select>
                                                </div>
                                                <button type="button" name="searchBtn" class="btn btn-sch" title="검색" id="searchBtn"><span class="ico">검색</span></button>
                                            </div>
                                        </div>
                                        <!-- //Form 날짜 -->
                                        <!-- Form 이력보기 -->
                                        <div class="form-group" style="float:right">
                                            <div class="form-group-area">
                                                <button name="button" class="btn btn-color2 btn-md" type="button" data-toggle="modal" data-target="#myAmtModal" id="amtHistoryBtn">이력보기</button>
                                            </div>
                                        </div>
                                        <!-- Form 이력보기 -->
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">판매금액<i class="i_star">필수입력</i></th>
                                <td>
                                    <table id="pricePerMonth-table">
                                        <tr>
                                            <th scope="row">
                                                <input type="button" value="&nbsp; - &nbsp;" onclick="delRow();">
                                                &nbsp;플랜&nbsp;
                                                <input type="button" value="&nbsp; + &nbsp;" onclick="addRow();">
                                            </th>
                                            <th scope="row">설명</th>
                                            <th scope="row">CPU</th>
                                            <th scope="row">Memory</th>
                                            <th scope="row">Disk</th>
                                            <th scope="row">가격</th>
                                        </tr>
                                        <tbody id="pricePerMonth-tbody">
                                        <tr th:each="softwarePlan, stat : ${softwarePlanList}">
                                            <td data-th-data-element-index="${stat.index}">
                                                <input type="checkbox" th:name="checkRow"/><input type=hidden th:value="${softwarePlan.id}" th:id="'planid_'+ ${stat.index}" th:name="'softwarePlanList['+${stat.index}+'].id'">&nbsp;<input type=text th:value="${softwarePlan.name}" th:id="'name_'+ ${stat.index}" th:name="'softwarePlanList['+${stat.index}+'].name'">
                                            </td>
                                            <td><input class="form-control" type="text" th:value="${softwarePlan.description}" th:id="'description_'+ ${stat.index}" th:name="'softwarePlanList['+${stat.index}+'].description'"></td>

                                            <td><input class="form-control" type="text" th:value="${#numbers.formatInteger(softwarePlan.cpuAmt, 0, 'COMMA')}" th:id="'cpuAmt_' +${stat.index}" th:name="'softwarePlanList['+${stat.index}+'].cpu'" th:onkeyup="'amt('+${stat.index}+')'" placeholder="₩ 1,000"></td>
                                            <td>
                                                <input class="form-control" type="text" th:value="${softwarePlan.memorySize}" th:id="'memorySize_'+${stat.index}" th:name="'softwarePlanList['+${stat.index}+'].memorySize'" th:onkeyup="'chk('+${stat.index}+')'"> &nbsp;<input class="form-control" type="text" th:value="${#numbers.formatInteger(softwarePlan.memoryAmt, 0, 'COMMA')}" th:id="'memoryAmt_' +${stat.index}" th:name="'softwarePlanList['+${stat.index}+'].memoryAmt'" th:onkeyup="'amt('+${stat.index}+')'" placeholder="₩ 1,000">
                                            </td>
                                            <td>
                                                <input class="form-control" type="text" th:value="${softwarePlan.diskSize}" th:id="'diskSize_'+${stat.index}" th:name="'softwarePlanList['+${stat.index}+'].diskSize'" th:onkeyup="'chk('+${stat.index}+')'">&nbsp;<input class="form-control" type="text" th:value="${#numbers.formatInteger(softwarePlan.diskAmt, 0, 'COMMA')}" th:id="'diskAmt_' +${stat.index}" th:name="'softwarePlanList['+${stat.index}+'].diskAmt'" th:onkeyup="'amt('+${stat.index}+')'" placeholder="₩ 1,000">
                                            </td>
                                            <td><input class="form-control" th:value="${#numbers.formatInteger((softwarePlan.memoryAmt + softwarePlan.diskAmt + softwarePlan.memoryAmt), 0, 'COMMA')}" th:id="'sumAmt_' +${stat.index}" name="sumAmt" readonly>
                                                <input type="hidden" th:id="'inUse_' +${stat.index}" th:name="'softwarePlanList['+${stat.index}+'].inUse'" th:value='${softwarePlan.inUse}'/>
                                                <input type="hidden" th:id="'applyMonth_' +${stat.index}" th:name="'softwarePlanList['+${stat.index}+'].applyMonth'" th:value='${softwarePlan.applyMonth}'/>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">전시여부<i class="i_star">필수입력</i></th>
                                <td>
                                    <div class="radio radio-inline" th:each="yn : ${yns}">
                                        <input name="softwareInUse" th:id="'radio1-' + ${yn}" type="radio" th:value="${yn}" th:checked="${software.inUse} == ${yn}">
                                        <label class="label" th:for="'radio1-' + ${yn}" th:text="${yn}"></label>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">버전</th>
                                <td><input class="form-control" style="width:100px;" type="text" th:value="${software.version}" id="softwareVersion" readonly></td>
                            </tr>
                            <tr>
                                <th scope="row">등록일자</th>
                                <td><input class="form-control" style="width:100px;" type="text" th:value="${#temporals.format(software.createdDate, 'yyyy-MM-dd')}" id="softwareCreatedDate" readonly></td>
                            </tr>
                            <tr>
                                <th scope="row">변경사항 메모<i class="i_star">필수입력</i></th>
                                <td>
                                    <div class="tbw_inner_txt">
                                        <pre><input class="form-control" type="text" id="softwareHistoryDescription" maxlength="200"></pre>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- //table -->
                </div>
                <!-- //inner -->
            </div>
        </div>
        <!-- //cBox1 -->
        <div class="cont_btnBox">
            <div class="pull-right">
                <button name="button" class="btn btn-color1 btn-md" type="button" id="saveBtn">저장</button>
                <!-- Modal -->
                <div class="modal fade" id="myModal_ok" tabindex="-1" role="dialog" aria-labelledby="modalLabel_update" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content modal-sm"><!-- 개발에서 사용하는 다른 팝업모듈 사용시 이부분만 사용하세요.  -->
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                <h4 class="modal-title" id="modalLabel_update">상품 수정</h4>
                            </div>
                            <div class="modal-body">
                                <div class="only-text">
                                    상품을 수정하시겠습니까?
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" name="button" class="btn btn-color1"  th:onclick="'javascript:modifySoftware(\''+ ${software.id} +'\');'">확인</button>
                                <button type="button" name="button" class="btn btn-color2" data-dismiss="modal">닫기</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- //Modal -->

                <button name="button" class="btn btn-color7 btn-md" type="button" data-toggle="modal" data-target="#myModal_cancel">취소</button>
                <!-- Modal -->
                <div class="modal fade" id="myModal_cancel" tabindex="-1" role="dialog" aria-labelledby="modalLabel_cancel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content modal-sm"><!-- 개발에서 사용하는 다른 팝업모듈 사용시 이부분만 사용하세요.  -->
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                                <h4 class="modal-title" id="modalLabel_cancel">수정 취소</h4>
                            </div>
                            <div class="modal-body">
                                <div class="only-text">
                                    취소 하시겠습니까?
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" name="button" class="btn btn-color1"  th:onclick="'location.href = \'' + @{/softwares/{id}(id=${software.id})} + '\''">확인</button>
                                <button type="button" name="button" class="btn btn-color2" data-dismiss="modal">닫기</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Modal -->
            </div>
        </div>
            <input type="hidden" id="finalPricePerMonth" name="pricePerMonth" value="0"/>
            <input type="hidden" id="applyMonth" name="applyMonth"/>
            <input type="hidden" id="softwarePlaneOriginalList" name="softwarePlaneOriginalList" value="111"/>
        </form>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="myModal_del" tabindex="-1" role="dialog" aria-labelledby="modalLabel_del" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content modal-sm"><!-- 개발에서 사용하는 다른 팝업모듈 사용시 이부분만 사용하세요.  -->
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                    <h4 class="modal-title" id="modalLabel_del">스크린 샷 삭제</h4>
                </div>
                <div class="modal-body">
                    <div class="only-text">
                        삭제 후 스크린 샷 복구가 불 가능합니다.<br> 삭제하시겠습니까?
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" name="button" id="deleteScreenShotBtn" class="btn btn-color1" onclick="deleteScreenShotBtn()" data-dismiss="modal">확인</button>
                    <button type="button" name="button" class="btn btn-color2" data-dismiss="modal">닫기</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal -->

    <!-- Modal -->
    <div class="modal fade" id="myModal_icon_del" tabindex="-1" role="dialog" aria-labelledby="modalLabel_icon_del" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content modal-sm"><!-- 개발에서 사용하는 다른 팝업모듈 사용시 이부분만 사용하세요.  -->
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                    <h4 class="modal-title" id="modalLabel_icon_del">아이콘 삭제</h4>
                </div>
                <div class="modal-body">
                    <div class="only-text">
                        삭제 후 아이콘 복구가 불 가능합니다.<br> 삭제하시겠습니까?
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" name="button" id="deleteIconBtn" class="btn btn-color1" onclick="deleteIconBtn()" data-dismiss="modal">확인</button>
                    <button type="button" name="button" class="btn btn-color2" data-dismiss="modal">닫기</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal -->

    <!-- amtModal -->
    <div class="modal fade" id="myAmtModal" tabindex="-1" role="dialog" aria-labelledby="myAmtModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="width:1000px;">
            <div class="modal-content" style="width:1000px;">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                    <h4 class="modal-title" id="myAmtModalLabel">판매금액 목록</h4>
                </div>
                <div class="modal-body">
                    <!-- table -->
                    <div class="tbl type1">
                        <td>
                            <table class="table" border="1">
                                <tr>
                                    <th scope="row" rowspan="2">적용월</th>
                                    <th scope="row" col style="width:auto;" colspan="3">Plan</th>
                                    <th scope="row" col style="width:auto;" colspan="3">기준금액</th>
                                    <th scope="row" rowspan="2">판매금액</th>
                                </tr>
                                <tr style="width:auto;" align=center>
                                    <td style="background-color: Silver;">Name</td>
                                    <td style="background-color: Silver;">Memory</td>
                                    <td style="background-color: Silver;">Disk</td>
                                    <td style="background-color: Silver;">CPU</td>
                                    <td style="background-color: Silver;">Memory</td>
                                    <td style="background-color: Silver;">Disk</td>
                                </tr>
                                <tbody id="amtArea">
                                <tr style="width:auto;" align=center>
                                </tbody>
                            </table>
                        </td>
                    </div>
                    <!--//table -->
                </div>
                <div class="modal-footer">
                    <button type="button" name="button" class="btn btn-color2" data-dismiss="modal">닫기</button>
                </div>
            </div>
        </div>
    </div>
    <!-- amtModal -->
	
    <input type="hidden" id="software" name="software" th:value="${software}" />
    <input type="hidden" id="id" name="id" th:value="${software.id}" />
    <input type="hidden" id="appPath" name="appPath" th:value="${software.appPath}" />
    <input type="hidden" id="screenshotList" name="screenshotList" th:value="${software.screenshotList}" />
    <input type="hidden" id="iconPath" name="iconPath" th:value="${software.iconPath}" />
    <input type="hidden" id="manifestPath" name="manifestPath" th:value="${software.manifestPath}" />
    <input type="hidden" id="indexForScreenShot" name="index" value="" />
    <input type="hidden" name="pricePerMonth" th:value="${software.pricePerMonth}"/>

    <!-- InstanceCartList Template -->
    <SCRIPT id="iconViewTemplate" type="text/html">
        <div class="fileUploadWrap selected_ico" style="width:50%;" name="reSelectPreview">
            <input tabindex="-1" class="form-control" id="iconFileInput" name="iconFile" multiple style="position: absolute; clip: rect(0px 0px 0px 0px);" type="file" data-icon-name="fa fa-upload" data-button-text="" data-class-input="form-control" data-class-button="btn btn-default" filestyle="" onchange="getThumbnailPreview(this, $('#icon_image'))">
            <div class="bootstrap-filestyle input-group" id="bootstrap-filestyle input-group">
                <span tabindex="0" class="group-span-filestyle input-group-btn">
                     <label class="btn btn-default " for="iconFileInput" id="icon_image">
                        <span class="ico ico_fileupload">파일찾기</span>
                    </label>
                </span>
                <div class="input-form-group">
                    <input name="userfile" disabled="" class="form-control" id="userfile" type="text" placeholder="아이콘으로 등록할 이미지를 선택하세요.">
                </div>
            </div>
        </div>
        <div class="fileUploadWrap selected_ico" style="width:50%;" name="divPreview">
            <div class="bootstrap-filestyle input-group" id="bootstrap-filestyle input-group2">
                <span tabindex="0" class="group-span-filestyle input-group-btn">
                     <label class="btn btn-default ">
                        <img class="logo" alt="" src="${iconPath}" id="iconFilePath" />
                     </label>
                </span>
                <div class="input-form-group">&nbsp;
                    <a href="" data-toggle="modal" data-target="#myModal_icon_del"><img src="../../static/images/ico_delete.png" alt="" /></a>&nbsp;
                    <span id="iconFileNamePreview">${icon}</span>
                </div>
                <div>
                    <label id="serviceLabelThumbName2" name="labelThumbName"></label>
                    <div id="serviceThumRemove2" name="thumRemove" class="pull-right file-remove-button">
                        <i class="fa fa-times"></i>
                    </div>
                </div>
            </div>
        </div>
	</SCRIPT>

    <!-- //content -->
    <script th:inline="javascript" type="text/javascript">
        /*<![CDATA[*/
        var FILE_INFO = {}; // 파일 초기화;
        var LOADING_TIME = 20;	//secend
    	var CURR_YEAR_MONTH = [[${currYearMonth}]];
    	var SELECT_YEAR_MONTH = [[${currYearMonth}]];

        //년/월
        var yearValue = $("#selectDateYear option:selected").val();
        var monthValue = $("#selectDateMonth option:selected").val();
        

        $(document).ready(function() {
            currentMenu('1_1');
            $('div[name=reSelectPreview]').hide();

            selectCal('selectDateMonth', 'selectDateYear');

            //최초화면 로딩
            nameIndex = $("#pricePerMonth-tbody tr").length;

            //최초 읽어온 데이터의 applyMonth를 전역변수에 저장
            var currApplyMonth = $("#pricePerMonth-tbody tr").eq(0).children().eq(5).children().eq(2).val();
            $("#applyMonth").val(currApplyMonth);
            $("#selectDateYear").val(Number(currApplyMonth.substring(0,4)));
            $("#selectDateMonth").val(Number(currApplyMonth.substring(4,7)));

            var softwarePlaneOriginalList = "";

            for (var idx=0; idx<nameIndex ;idx++) {
                if (idx == 0) {
                    softwarePlaneOriginalList += $("#planid_"+idx).val();
                } else {
                    softwarePlaneOriginalList += "^"+ $("#planid_"+idx).val();
                }
            }
            $("#softwarePlaneOriginalList").val(softwarePlaneOriginalList);
            
            disablePricePerMonth();
        });
        
        // [상품] 리스트
        var getSoftwareList = function () {
            var software = $("#software").val();
            var id = $("#id").val();
        };

        //[저장]버튼
        function isEmpty(val) {
            return (val == null || val == "");
        };

		$('#saveBtn').click(function() {
            // TR Rows
            var trRows = $("#pricePerMonth-tbody tr");
            var manCheck = false;
            var msg = "";

         	// 상품명
            if (!manCheck && commonUtils.isBlank($("#softwareName").val())) {
            	msg = "상품명을 입력하십시오.";
                manCheck = true;
            }
            // 카테고리
            if (!manCheck && commonUtils.isBlank($("#softwareCategory").val())) {
            	msg = "카테고리를 선택해주세요.";
                manCheck = true;
            }
            // 개요
            if (!manCheck && commonUtils.isBlank($("#softwareSummary").val())) {
            	msg = "상품 개요를 입력하십시오.";
                manCheck = true;
            }
            // 아이콘
            if (!manCheck && commonUtils.isBlank($("#iconFilePath").attr("src"))) {
            	msg = "아이콘을 등록해주세요.";
                manCheck = true;
            }
            // 스크린샷
            var screenshotObjList = $('[name="li_in"]');
            if (!manCheck && commonUtils.isEmpty(screenshotObjList) || $('[name="li_in"]').length <= 0) {
            	msg = "스크린샷을 등록해주세요.";
                manCheck = true;
            }
            //판매금액
            trRows.each(function(index, item){
                var tdRows = $(this).children("td");
                var eleindex = tdRows.eq(0).data("elementIndex");
                var softwarePlanInfo = {};

                if(!manCheck && !manCheck && isEmpty($("#name_"+eleindex).val())) {
                    msg = "플랜명을 입력하십시오.";
                    manCheck = true;
                }
                if(!manCheck && !manCheck && isEmpty($("#description_"+eleindex).val())) {
                    msg = "플랜 설명을 입력하십시오.";
                    manCheck = true;
                }
                if(!manCheck && !manCheck && isEmpty($("#cpuAmt_"+eleindex).val())) {
                    msg = "CPU 가격을 입력하십시오.";
                    manCheck = true;
                }
                if(!manCheck && !manCheck && isEmpty($("#memorySize_"+eleindex).val())) {
                    msg = "메모리 크기를 입력하십시오.";
                    manCheck = true;
                }
                if(!manCheck && !manCheck && isEmpty($("#memoryAmt_"+eleindex).val())) {
                    msg = "메모리 가격을 입력하십시오.";
                    manCheck = true;
                }
                if(!manCheck && !manCheck && isEmpty($("#diskSize_"+eleindex).val())) {
                    msg = "디스크 크기를 입력하십시오.";
                    manCheck = true;
                }
                if(!manCheck && !manCheck && isEmpty($("#diskAmt_"+eleindex).val())) {
                    msg = "디스크 가격을 입력하십시오.";
                    manCheck = true;
                }
            })
            //변경사항 메모
            if (!manCheck && commonUtils.isBlank($("#softwareHistoryDescription").val())) {
            	msg = "변경사항 메모를 입력하지 않았습니다.";
                manCheck = true;
            }

            // 알림 노출
            if(manCheck) {
                commonAlert.show(msg, "softwareHistoryDescription");
                return;
            }
            
			// 저장 Confirm 노출
   			$('div #myModal_ok').modal();
		});

        // 상품 수정(텍스트)
        var modifySoftware = function (argSoftwareId) {
            if (doubleSubmitCheck()) {
            	return;
            }

            $('#myModal_ok').modal("hide");
            loading.start("상품 정보 수정중...");
            
            var reqParam = {
                "inUse" : $('input:radio[name="softwareInUse"]:checked').val(),
                "name" :  $("#softwareName").val(),
                "category" : {
                    "id" :  $("#softwareCategory option:selected").val()
                },
                "summary" :  $("#softwareSummary").val(),
                "description" : $("#softwareDescription").val(),
                "type" : $('input:radio[name="softwareType"]:checked').val(),
                "pricePerMonth" : $("#finalPricePerMonth").val(),
                "version" :  $("#softwareVersion").val(),
                "historyDescription" : $("#softwareHistoryDescription").val(),
                "softwarePlanList" : []
            };

        	var softwarePlanList = [];
        	var trRows = $("#pricePerMonth-tbody tr");

            // TR Rows
        	trRows.each(function(index, item){
        	    var tdRows = $(this).children("td");
        	    var softwarePlanInfo = {};

        	    // TD Rows
        	    tdRows.each(function(index, item){
                    var tdChildrenObj = $(this).children();
                    if (index == 0) {
                        softwarePlanInfo.softwareId = argSoftwareId;
                        softwarePlanInfo.id = tdChildrenObj.eq(1).val();
                        softwarePlanInfo.name = tdChildrenObj.eq(2).val();
                    } else if (index == 1) {
                        softwarePlanInfo.description = tdChildrenObj.eq(0).val();
                    } else if (index == 2) {
                        softwarePlanInfo.cpuAmt = commonUtils.onlyNumber(tdChildrenObj.eq(0).val());
                    } else if (index == 3) {
                        softwarePlanInfo.memorySize = tdChildrenObj.eq(0).val();
                        softwarePlanInfo.memoryAmt = commonUtils.onlyNumber(tdChildrenObj.eq(1).val());
                    } else if (index == 4) {
                        softwarePlanInfo.diskSize = tdChildrenObj.eq(0).val();
                        softwarePlanInfo.diskAmt = commonUtils.onlyNumber(tdChildrenObj.eq(1).val());
                    }
                    else if (index == 5) {
                        softwarePlanInfo.inUse = tdChildrenObj.eq(1).val();
                        softwarePlanInfo.applyMonth = tdChildrenObj.eq(2).val();
                    }
                })

                softwarePlanList[softwarePlanList.length] = softwarePlanInfo;
            });
            reqParam.softwarePlanList = softwarePlanList;

        	var softwarePlaneOriginalList = encodeURI($("#softwarePlaneOriginalList").val());
            var reqUrl = "/softwares/" + argSoftwareId +"?softwarePlaneOriginalList="+ softwarePlaneOriginalList;
            procCallAjax(reqUrl, "PUT", JSON.stringify(reqParam), null, callbackModifySoftware);
        };

        var callbackModifySoftware = function (data) {
            procMovePage("/softwares/{id}".replace("{id}", data.id));
        };

        //[아이콘] 화면 리스트
        var getThumbnailPreview = function (html, $target) {
            if (html.files && html.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    $target.css('display', '');
                    $target.html('<img src="' + e.target.result + '" border="0" alt="" />');
                };
                reader.readAsDataURL(html.files[0]);
            }

            //[아이콘] 수정
            if(html.files[0] == null){
                return null;
            }else{
                var fileInfo = html.files[0];
                // Swift - create
                registerFile(fileInfo, "icon");
            }
        };

        // [아이콘] Swift 삭제
        function deleteIconBtn() {
        	$("#myModal_icon_del").modal("hide");
        	loading.interval(LOADING_TIME, "아이콘 이미지 삭제중...");
        	
            // Swift - delete
            var iconImagePath = jQuery('#iconFilePath').attr("src");
            var imgPath = iconImagePath.substring(iconImagePath.lastIndexOf("/") + 1);
            var reqUrl = "/v2/swift/{name}".replace("{name}", imgPath);
            
            procCallAjax(reqUrl ,"DELETE", null, null, callbackDeleteIconSwift);
        }

        // [아이콘] 삭제정보 DB UPDATE
        var callbackDeleteIconSwift = function (data) {
            $('div[name=divPreview]').hide();
            $('div[name=reSelectPreview]').show();
			            
            var id = $("#id").val();
            var iconFileName = $("#iconFileNamePreview").text();
            var param = {
                "filePath": null,
                "fileName": null,
                "historyDescription": "아이콘 삭제 ["+ iconFileName +"]"
            };

            var url = encodeURI("/softwares/file/"+ id + "/icon");
            procCallAjax(url, "PUT", JSON.stringify(param), null, callbackDeleteIconFileDb);
        };
        
        // [아이콘] 등록 필수사항 Alert
        var callbackDeleteIconFileDb = function() {
        	loading.stop();
        	commonAlert.show("반드시 아이콘을 추가해주시기 바랍니다.");
        }

        //[스크린 샷] Confirm Modal 호출 및 현재 선택한 스크린샷 id정보 저장
        function clickModal(target) {
            var index = $(target).attr('id');
            $("#indexForScreenShot").val(index);
            $('div #myModal_del').modal();
        }

        //[스크린 샷] 화면 리스트
        var getThumbnailPreviewScreenshot = function (html, $target, countNum) {
            var reader = new FileReader();
            reader.onload = function (e) {
                $target.css('display', '');
                $target.html( '<li name="li_in" id="new_li_in'+ countNum + '">\n' +
                    '<div class="sshot_in">\n' +
                    '<img src="' + e.target.result + '" alt="" id="image_form_url">\n' +
                    '<a href="" data-toggle="modal" data-target="#myModal_del"><span class="ico ico_delete" name="ico_delete">X</span></a>\n' +
                    '</div>\n' +
                    '</li>');
            };
            reader.readAsDataURL(html.files[0]);

            var currentTag = "#li_" + countNum;

            // 이미지 파일 첨부 버튼 추가 하기
            // 새로운 div 생성
            var obj = $(currentTag).clone();
            obj.attr('id', 'li_' + (countNum + 1));
            obj.find("label").attr('id', 'screenshot_image_list' + (countNum + 1));
            obj.find("label").attr('for', 'screenshotFileInput' + (countNum + 1));
            obj.find("input").attr('id', 'screenshotFileInput' + (countNum + 1));

            // 초기화
            obj.find("input").attr('onchange', '');
            obj.find("input").attr('name', '');

            $(currentTag).after(obj);

            //[스크린 샷] 수정
            if(html.files[0] == null){
                return null;
            }else{
                var fileInfo = html.files[0];
                registerFile(fileInfo, "screenShots");
            }
        };


        //[스크린 샷, 아이콘] 파일 첨부 확인 및 업로드
        function registerFile(data, fileType) {
            var formData = new FormData();
            formData.append("file", data);

            if(fileType === "screenShots") {
            	loading.interval(LOADING_TIME, "스크린샷 이미지 등록중...");
                uploadFile(formData,"POST","/v2/swift", createRegisterFileInfo);
            }

            if(fileType === "icon") {
            	loading.interval(LOADING_TIME, "아이콘 이미지 등록중...");
                uploadFile(formData,"POST","/v2/swift", createIconFile);
            }

            if(fileType === "prodFile") {
                uploadFile(formData,"POST","/v2/swift", createProdFile);
            }

            if(fileType === "envFile") {
                uploadFile(formData,"POST","/v2/swift", createEnvFile);
            }
        }

        //[아이콘] 신규 이미지 추가 (DB - icon, iconPath => update)
        function createIconFile(data){
            var id = $("#id").val();

            if(data != null){
                FILE_INFO.iconFileName  = data.filename;
                FILE_INFO.iconFilePath  = data.fileURL;
            }

            var param = {
                "filePath": FILE_INFO.iconFilePath,
                "fileName": FILE_INFO.iconFileName,
                "historyDescription": "아이콘 등록 ["+ FILE_INFO.iconFileName +"]"
            };

            var url = encodeURI("/softwares/file/"+ id + "/icon");
            procCallAjax(url, "PUT", JSON.stringify(param), null, callbackIconFileDb);
        }
        
        //[아이콘] DB UPDATE 후에 화면 처리 작업
        function callbackIconFileDb(data) {
			var iconViewTemplateHtml = $("#iconViewTemplate").text();
			
			// 아이콘 화면 초기화
			$("#ICON_REGISTRY_AREA").html("");
			
			// 아이콘 화면 VIEW로 UPDATE
			$.tmpl(iconViewTemplateHtml, data).appendTo("#ICON_REGISTRY_AREA");
			
			// 아이콘 화면 FILE_UPLOAD 화면 감추기
			$('#ICON_REGISTRY_AREA div[name=reSelectPreview]').hide();
			loading.stop();
        }

        //[스크린 샷] 신규 이미지 추가
        function createRegisterFileInfo(data){
            var id = $("#id").val();

            if(data != null){
                FILE_INFO.screenshots  = data.filename;
                FILE_INFO.screenshotsFilePath  = data.fileURL;
                FILE_INFO.screenshotsFileSize  = data.length;
            }

            var param = {
                "filePath": FILE_INFO.screenshotsFilePath,
                "historyDescription": "스크린샷 등록 ["+ decodeURIComponent(FILE_INFO.screenshotsFilePath) +"]"
            };

            var url = encodeURI("/softwares/file/"+ id + "/screenShots");
            procCallAjax(url, "PUT", JSON.stringify(param), null, totalScreenShotList);
        }

        // 스크린샷 리스트 재정렬
        var totalScreenShotList = function (data) {
            var htmlString = [];

            if(data.screenshotList.length > 0) {
                for(var i = 0; i < data.screenshotList.length; i++) {
                    var screenShot = data.screenshotList[i];

                    htmlString +='<li name="li_in" id="li_in'+ i + '">\n' +
		                        '	<div class="sshot_in">\n' +
		                        '		<img src="' + screenShot + '" alt="" id="image_form_url'+ i + '">\n' +
		                        '		<a href="#" onclick="clickModal(this)" id="' + i +'"><span class="ico ico_delete" name="ico_delete">X</span></a>\n' +
		                        '	</div>\n' +
		                        '</li>';
                }
            }

            htmlString +=
                '<li id="li_0">\n' +
                '    <div class="fileUploadWrap selected_sshot">\n' +
                '        <input tabindex="-1" class="form-control" id="screenshotFileInput" style="position: absolute; clip: rect(0px 0px 0px 0px);" type="file" name="screenshots"\n' +
                '               multiple="multiple" data-icon-name="fa fa-upload" data-button-text="" data-class-input="form-control" data-class-button="btn btn-default" filestyle=""\n' +
                '               onchange="getThumbnailPreviewScreenshot(this, $(\'#screenshot_image_list\'), 0)">\n' +
                '        <div class="bootstrap-filestyle input-group">\n' +
                '            <span tabindex="0" class="group-span-filestyle input-group-btn">\n' +
                '                <label class="btn btn-default " for="screenshotFileInput" id="screenshot_image_list">\n' +
                '                    <span class="ico ico_fileupload">파일찾기</span>\n' +
                '                </label>\n' +
                '            </span>\n' +
                '        </div>\n' +
                '    </div>\n' +
                '</li>';

            $("#screenShotTotal").html(htmlString);
            loading.stop();
        };

        //[스크린 샷] Swift 파일삭제
        function deleteScreenShotBtn() {
        	$("#myModal_del").modal("hide");
        	loading.interval(LOADING_TIME, "스크린샷 이미지 삭제중...");
        	
            var index = $("#indexForScreenShot").val();
            var selectId = "#image_form_url" + index;
            var selectedScreenshot = $(selectId).attr("src");
            var imgPath = selectedScreenshot.substring(selectedScreenshot.lastIndexOf("/") + 1);
            
            // 삭제된 스크린샷 히스토리 정보 설정
            FILE_INFO.deleteImagePath = selectedScreenshot;
           
            var reqUrl = "/v2/swift/{name}".replace("{name}", imgPath);
            procCallAjax(reqUrl ,"DELETE", null, null, callbackDeleteScreenShotSwift);
        }

        var callbackDeleteScreenShotSwift = function (data) {
            if ("SUCCESS" == data.result) {
                deleteScreenShot(data.deletedImgPath);
            } else {
            	loading.stop();
            }
        };

        // [스크린 샷] 삭제정보 DB UPDATE
        function deleteScreenShot(imgPath) {
            var id = $("#id").val();
            var param = {
                "historyDescription": "스크린샷 삭제 ["+ FILE_INFO.deleteImagePath +"]"
            };

            procCallAjax("/softwares/file/"+ id + "/screenShots/" + imgPath, "DELETE", JSON.stringify(param), null, totalScreenShotList);
        }

        // reqType 따른 파일 업로드/삭제 처리
        var uploadFile = function(formData, reqType, reqUploadUrl, reqProcFunction) {
            $.ajax({
                url : reqUploadUrl
                , method : reqType
                , processData : false
                , contentType : false
                , data : formData
                , dataType : "json"
                , timeout : 600000
                ,success : function(data){
                    if(reqType == "DELETE"){ // 삭제시 파일정보 초기화
                        data.filename = "";
                        data.fileURL  = "";
                        data.length   = "";
                    }

                    if(reqProcFunction != null){
                        reqProcFunction(data);
                    }
                },
                error: function(xhr, status, error) {
                    notifyAlert('danger','',JSON.parse(xhr.responseText).message);
                },
                complete : function(data) {
                    //console.log("COMPLETE :: data :: ", data);
                }
            });
        };

        // [공통] 파일 첨부 시 이름 추출
        var extractFileName = function(html, $target, type) {
            var val = $(html).val().split("\\");
            var f_name = val[val.length-1]; //마지막 화일명
            var s_name = f_name.substring(f_name.length-4, f_name.length);//확장자빼오기

            $target.val(f_name);

            var reader = new FileReader();
            reader.readAsDataURL(html.files[0]);

            if(html.files[0] == null){
                return null;
            }else{
                var fileInfo = html.files[0];

                if(type === "prodFile") {
                    registerFile(fileInfo, "prodFile");
                }

                if(type === "envFile") {
                    registerFile(fileInfo, "envFile");
                }
            }
        };

        // 상품 파일 swift 생성
        var createProdFile = function(data) {
            var id = $("#id").val();

            if(data != null){
                FILE_INFO.prodFileName  = data.filename;
                FILE_INFO.prodFilePath  = data.fileURL;
            }

            var param = {
                "filePath": FILE_INFO.prodFilePath,
                "fileName": data.filename
            };

            var url = encodeURI("/softwares/file/"+ id + "/prodFile");
            procCallAjax(url, "PUT", JSON.stringify(param), null, callbackFileDb);
        };

        // 환경 파일 swift 생성
        var createEnvFile = function(data) {
            var id = $("#id").val();

            if(data != null){
                FILE_INFO.envFileName  = data.filename;
                FILE_INFO.envFilePath  = data.fileURL;
            }

            var param = {
                "filePath": FILE_INFO.envFilePath,
                "fileName": data.filename
            };

            var url = encodeURI("/softwares/file/"+ id + "/envFile");
            procCallAjax(url, "PUT", JSON.stringify(param), null, callbackFileDb);
        };

        // 상품 파일 삭제
        $("#deleteProdFile").on("click", function () {
            var prodFilePath = $("#appPath").val();

            var filePath = prodFilePath.substring(prodFilePath.lastIndexOf("/") + 1);
            var reqUrl = "/v2/swift/{name}".replace("{name}", filePath);
            procCallAjax(reqUrl ,"DELETE", null, null, callbackDeleteProdFileSwift);

        });

        var callbackDeleteProdFileSwift = function(data) {
            $("#softwareAppFileDiv").contents('input').attr('value', "");
            commonAlert.show("반드시 상품 파일을 추가해주시기 바랍니다.");
        };

        // 환경 파일 삭제
        $("#deleteManifestFile").on("click", function () {
            var envFilePath = $("#manifestPath").val();

            var filePath = envFilePath.substring(envFilePath.lastIndexOf("/") + 1);
            var reqUrl = "/v2/swift/{name}".replace("{name}", filePath);
            procCallAjax(reqUrl ,"DELETE", null, null, callbackDeleteEnvFileSwift);
        });

        var callbackDeleteEnvFileSwift = function(data) {
            $("#softwareManifestFileDiv").contents('input').attr('value', "");
            commonAlert.show("반드시 환경 파일을 추가해주시기 바랍니다.");
        };

        $("#amtHistoryBtn").on("click", function () {
            var softwareId = "[[${software.id}]]";

            var reqUrl = "/softwares/plan/" + softwareId + "/histories" + "?sort=applyMonth,asc";
            procCallAjax(reqUrl, "GET", null, null, callbackGetSoftwarePlanHistoryList);
        });

        var callbackGetSoftwarePlanHistoryList = function (data) {
            var amtArea = $("#amtArea");
            var htmlString = [];

            if(data.length > 0){
                for(var i = 0; i < data.length; i++){
                    var totalAmt = data[i].cpuAmt+data[i].memoryAmt+data[i].diskAmt;

                    htmlString.push(
                        '<tr style="width:auto;" align=center>'
                        + '<td>'+data[i].applyMonth+'</td>'
                        + '<td>'+data[i].name+'</td>'
                        + '<td>'+data[i].memorySize+'</td>'
                        + '<td>'+data[i].diskSize+'</td>'
                        + '<td>'+commonUtils.addComma(data[i].cpuAmt)+'</td>'
                        + '<td>'+commonUtils.addComma(data[i].memoryAmt)+'</td>'
                        + '<td>'+commonUtils.addComma(data[i].diskAmt)+'</td>'
                        + '<td>'+commonUtils.addComma(totalAmt)+'</td>'
                        + '</tr>'
                    );
                }
            }else{
                htmlString = "<tr>"
                    + "<td colspan='8'><p class='user_p'>판매금액 이력이 존재하지 않습니다.</p></td>" + "</tr>"
            }

            amtArea.html(htmlString);
        };


        //[테이블] 가격
        function amt(id){
            var tempCpuAmt = commonUtils.onlyNumber($("#cpuAmt_"+id).val());
            var tempMemoryAmt = commonUtils.onlyNumber($("#memoryAmt_"+id).val());
            var tempDiskAmt = commonUtils.onlyNumber($("#diskAmt_"+id).val());
            $("#sumAmt_"+id).val(commonUtils.addComma(Number(tempCpuAmt) + Number(tempMemoryAmt) + Number(tempDiskAmt)));

            $("#cpuAmt_"+id).val(commonUtils.addComma(tempCpuAmt));
            $("#memoryAmt_"+id).val(commonUtils.addComma(tempMemoryAmt));
            $("#diskAmt_"+id).val(commonUtils.addComma(tempDiskAmt));
        };

        //[테이블] 행 삭제
        function delRow(){
        	if (selectDateIsPastCurrent()) {
        		commonAlert.show("판매금액 적용월이 현재일 이후로만 판매금액을 삭제 하실수 있습니다.", "searchBtn");
        		return;
        	}

            var checkbox = $("input[name='checkRow']");
            var checkCount = checkbox.size();
            var swpId =  $("#planid").val();

            for (var i=0; i<checkCount; i++) {
                if (checkbox.eq(i).is(":checked")) {
                    checkbox.eq(i).parent().parent().remove();
                }
            }
        };

        //[테이블] 행 추가
        var index = 1000;
        var nameIndex = 0;
        function addRow() {
        	if (selectDateIsPastCurrent()) {
        		commonAlert.show("판매금액 적용월이 현재일 이후로만 판매금액을 추가 하실수 있습니다.", "searchBtn");
        		return;
        	}

            index++;
            nameIndex++;
            var toDayValue = $('#applyMonth').val();

            document.getElementById("pricePerMonth-tbody").insertRow(-1).innerHTML =
                "<tr>"
                +"	<td data-element-index='"+index+"'>"
                +"		<input type='checkbox' id='checkRow' name='checkRow'><input type=hidden id='planid_"+index+"' name='softwarePlanList["+nameIndex+"].id'>&nbsp;<input type='text' id='name_"+index+"' name='softwarePlanList["+nameIndex+"].name' placeholder='Small'>"
                +"	</td>"
                +"	<td><input class='form-control' type='text' id='description_"+index+"' name='softwarePlanList["+nameIndex+"].description' placeholder='표준성능'></td>"
                +"	<td><input class='form-control' type='text' id='cpuAmt_"+index+"' name='softwarePlanList["+nameIndex+"].cpuAmt' onkeyup='amt("+index +")' placeholder='₩ 1,000'></td>"
                +"	<td>"
                +"		<input class='form-control' type='text' id='memorySize_"+index+"' name='softwarePlanList["+nameIndex+"].memorySize' onkeyup='chk("+index+")' placeholder='1234M'>  &nbsp;<input class='form-control' type='text' id='memoryAmt_"+index+"' name='softwarePlanList["+nameIndex+"].memoryAmt' onkeyup='amt("+index+")' placeholder='₩ 1,000'>"
                +"	</td>"
                +"	<td>"
                +"		<input class='form-control' type='text' id='diskSize_"+index+"' name='softwarePlanList["+nameIndex+"].diskSize' onkeyup='chk("+index+")' placeholder='1G'>  &nbsp;<input class='form-control' type='text' id='diskAmt_"+index+"' name='softwarePlanList["+nameIndex+"].diskAmt' onkeyup='amt("+index+")' placeholder='₩ 1,000'>"
                +"	</td>"
                +"	<td>"
                +"		<input class='form-control' type='text' id='sumAmt_"+index+"' name='sumAmt' readonly>"
                +"      <input type='hidden' id='inUse_"+index+"' name='softwarePlanList["+nameIndex+"].inUse' value='Y'>"
                +"		<input type='hidden' name='softwarePlanList["+nameIndex+"].applyMonth' value='"+toDayValue+"'>"
                +"	</td>"
                +"</tr>";
        };

        //[공통] 년,월(select box)
        function selectCal(monthfield, yearfield) {
            var today = new Date();
            yearValue = today.getFullYear();
            monthValue = (today.getMonth() + 1);

            for (var i = 1; i < 13; i++) {
                if ((today.getMonth() + 1) == i) $("#" + monthfield).append("<option value='" + i + "' selected='selected'>" + i + "</option>");
                else $("#" + monthfield).append("<option value='" + i + "'>" + i + "</option>");
            }

            var thisyear = today.getFullYear();
            for (var y = thisyear - 10; y < thisyear + 10; y++) {

                if (thisyear == y) $("#" + yearfield).append("<option value='" + y + "' selected='selected'>" + y + "</option>");
                else $("#" + yearfield).append("<option value='" + y + "'>" + y + "</option>");
            }
        }

        var selectYear = function() {
            var selectedYearValue = $("#selectDateYear option:selected").val();
            yearValue = selectedYearValue;
        };

        var selectMonth = function() {
            var selectedMonthValue = $("#selectDateMonth option:selected").val();
            monthValue = selectedMonthValue;
        };

        //eventBtn
        $("#searchBtn").on("click", function () {
        	SELECT_YEAR_MONTH = $("#selectDateYear").val() + commonUtils.dateValueDigit($("#selectDateMonth").val());
        	
            var id = $("#id").val();
            var selectDateYear = $("#selectDateYear").val();
            var selectDateMonth = $("#selectDateMonth").val();
            var applyMonth = selectDateYear +  fncDateValueDigit(selectDateMonth);
            $('#applyMonth').val(applyMonth);

            var url = encodeURI("/softwares/plan/" + id + "/applyMonth");
            procCallAjax(url+"?applyMonth="+ applyMonth, "GET", "", null, callbackRow);
        });

        //2019-00년월 확인
        function fncDateValueDigit(value) {
            var result = value;
            if (value < 10) {
                result = '0' + value;
            }
            return result;
        }

        //리로드시, 값 초기화 셋팅(data)
        var callbackRow  = function (data) {
            var tempCpuAmt = 0;
            var tempMemoryAmt = 0;
            var tempDiskAmt = 0;
            var tempTotalAmt = 0;
            
            $('#pricePerMonth-tbody').html("");
            $("#softwarePlaneOriginalList").val("");

            var orginPlanIdList = "";
            nameIndex = 0;

            if(data.length > 0){
                for(var i = 0; i < data.length; i++){
                    orginPlanIdList += "^"+ data[i].id;
                    tempCpuAmt = commonUtils.addComma(data[i].cpuAmt);
                    tempMemoryAmt = commonUtils.addComma(data[i].memoryAmt);
                    tempDiskAmt = commonUtils.addComma(data[i].diskAmt);
                    tempTotalAmt = commonUtils.addComma(data[i].cpuAmt + data[i].memoryAmt + data[i].diskAmt);

                    $('#pricePerMonth-tbody').append(
                        "<tr>"
                        +"	<td data-element-index='"+index+"'>"
                        +"		<input type='checkbox' id='checkRow' name='checkRow'><input type=hidden id='planid_"+index+"' name='softwarePlanList["+nameIndex+"].id' value='"+data[i].id+"'>&nbsp;<input type='text' id='name_"+index+"' name='softwarePlanList["+nameIndex+"].name' value='"+data[i].name+"' placeholder='Small'>"
                        +"	</td>"
                        +"	<td><input class='form-control' type='text' id='description_"+index+"' name='softwarePlanList["+nameIndex+"].description' value='"+data[i].description+"' placeholder='표준성능'></td>"
                        +"	<td><input class='form-control' type='text' id='cpuAmt_"+index+"'  name='softwarePlanList["+nameIndex+"].cpuAmt' value='"+tempCpuAmt+"' onkeyup='amt("+index +")' placeholder='₩ 1,000'></td>"
                        +"	<td>"
                        +"		<input class='form-control' type='text' id='memorySize_"+index+"' name='softwarePlanList["+nameIndex+"].memorySize' value='"+data[i].memorySize+"' onkeyup='chk("+index+")' placeholder='1234M'>  &nbsp;<input class='form-control' type='text' id='memoryAmt_"+index+"' name='softwarePlanList["+nameIndex+"].memoryAmt' value='"+tempMemoryAmt+"' onkeyup='amt("+index+")' placeholder='₩ 1,000'>"
                        +"	</td>"
                        +"	<td>"
                        +"		<input class='form-control' type='text' id='diskSize_"+index+"' name='softwarePlanList["+nameIndex+"].diskSize' value='"+data[i].diskSize+"' onkeyup='chk("+index+")' placeholder='1G'>  &nbsp;<input class='form-control' type='text' id='diskAmt_"+index+"' name='softwarePlanList["+nameIndex+"].diskAmt' value='"+tempDiskAmt+"' onkeyup='amt("+index+")' placeholder='₩ 1,000'>"
                        +"	</td>"
                        +"	<td>"
                        +"		<input class='form-control' type='text' id='sumAmt_"+index+"' name='sumAmt' value='"+tempTotalAmt+"' readonly>"
                        +"      <input type='hidden' id='inUse_"+index+"' name='softwarePlanList["+nameIndex+"].inUse' value='"+data[i].inUse+"' >"
                        +"		<input type='hidden' name='softwarePlanList["+nameIndex+"].applyMonth' value='"+data[i].applyMonth+"'>"
                        +"	</td>"
                        +"</tr>"
                    );

                    nameIndex++;
                    index++;
                }
                $("#softwarePlaneOriginalList").val(orginPlanIdList);
            } else {
        		commonAlert.show("조회한 판매금액 적용월에 판매금액이 존재하지 않습니다.", "searchBtn");
            }
            
            disablePricePerMonth();
        };

        //Pattern Matching
        var chk = function(id) {
            var str1 = $("#memorySize_"+id).val();
            var str2 = $("#diskSize_"+id).val();

            for (i = 0; i < str1.length; i++) {
                ch = str1.charAt(i);
                if (!(ch >= '0' && ch <= '9') && !(ch == 'G' || ch == 'M')) {
                	commonAlert.show("입력 형식은 숫자와 M 또는 G 입니다.");
                    $("#memorySize_"+id).val("");
                    return false;
                }
            }

            for (i = 0; i < str2.length; i++) {
                ch = str2.charAt(i);
                if (!(ch >= '0' && ch <= '9') && !(ch == 'G' || ch == 'M')) {
                	commonAlert.show("입력 형식은 숫자와 M 또는 G 입니다.");
                    $("#diskSize_"+id).val("");
                    return false;
                }
            }
        };
        
        var disablePricePerMonth = function() {
        	if (!selectDateIsPastCurrent()) {
        		return;
        	}
        	
        	var obj;
        	$("#pricePerMonth-tbody :text").each(function(){
        		obj = $(this);
        		if (obj.prop("type") == "text") {
        			obj.prop("readOnly", true)
        		}
        	});
        }
        
        var selectDateIsPastCurrent = function() {
        	if (SELECT_YEAR_MONTH <= CURR_YEAR_MONTH) {
        		return true;
        	}
			return false;
        }
        /*]]>*/
    </script>
</div>
</html>
